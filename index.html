<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mezo Matsnet Activity Statistics</title>
  <meta name="description" content="Track and analyze activity on Mezo Matsnet. View transaction statistics, deployed contracts, and claimed matsnet sats. By Mallard Labs.">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://test-mezo.activity.mallardlabs.xyz/">
  <meta property="og:title" content="Mezo Matsnet Activity Statistics">
  <meta property="og:description" content="Track and analyze activity on Mezo Matsnet. View transaction statistics, deployed contracts, and claimed matsnet sats. By Mallard Labs.">
  <meta property="og:image" content="https://test-mezo.activity.mallardlabs.xyz/assets/images/mezo-preview.webp">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://test-mezo.activity.mallardlabs.xyz/">
  <meta property="twitter:title" content="Mezo Matsnet Activity Statistics">
  <meta property="twitter:description" content="Track and analyze activity on Mezo Matsnet. View transaction statistics, deployed contracts, and claimed matsnet sats. By Mallard Labs.">
  <meta property="twitter:image" content="https://test-mezo.activity.mallardlabs.xyz/assets/images/mezo-preview.webp">

  <!-- Add favicon link -->
  <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">

  <!-- Add Inter font from Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #e91e63;
      --primary-dark: #c2185b;
      --primary-light: #f48fb1;
      --accent-color: #ff4081;
      --text-color: #333;
      --bg-color: #fff;
      --card-bg: #f9f9f9;
      --border-color: #e0e0e0;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif; /* Change to Inter font */
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background-color: var(--primary-color);
      color: white;
      padding: 20px 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      font-size: 24px;
      font-weight: 600;
    }

    .credit {
      font-size: 14px;
      font-weight: 500;
    }

    .credit a {
      color: white;
      text-decoration: none;
      transition: opacity 0.3s;
    }

    .credit a:hover {
      opacity: 0.8;
    }

    .visit-counter {
      background-color: rgba(0, 0, 0, 0.1);
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      margin-top: 5px;
      display: inline-block;
    }

    .main-content {
      margin-top: 40px;
    }

    .card {
      background-color: var(--card-bg);
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 20px;
      margin-bottom: 20px;
    }

    .card-header {
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-dark);
      margin-bottom: 10px;
    }

    .btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }

    .btn:hover {
      background-color: var(--primary-dark);
    }

    .btn:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      width: 100%;
      max-width: 400px;
    }

    .search-input {
      flex: 1;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th, .data-table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
      background-color: var(--primary-light);
      color: var(--text-color);
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      position: relative;
    }

    .data-table th:hover {
      background-color: var(--primary-color);
      color: white;
    }

    .data-table th.sorted-asc::after {
      content: "▲";
      margin-left: 5px;
      font-size: 12px;
    }

    .data-table th.sorted-desc::after {
      content: "▼";
      margin-left: 5px;
      font-size: 12px;
    }

    .data-table tbody tr:hover {
      background-color: rgba(244, 143, 177, 0.1);
    }

    .address-cell {
      font-family: 'Inter Mono', monospace;
      word-break: break-all;
    }

    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .pagination-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .page-info {
      font-size: 14px;
    }

    .items-per-page {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .items-per-page select {
      padding: 6px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-family: 'Inter', sans-serif;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    .stat-card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      padding: 20px;
      text-align: center;
      border-top: 4px solid var(--primary-color);
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-dark);
      margin: 10px 0;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
    }

    .loader {
      display: flex;
      justify-content: center;
      padding: 40px 0;
    }

    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-left-color: var(--primary-color);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-message {
      background-color: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #c62828;
    }

    .hidden {
      display: none;
    }

    .jump-to-page {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .jump-to-page input {
      width: 60px;
      padding: 6px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      text-align: center;
      font-family: 'Inter', sans-serif;
    }

    .realtime-link {
      text-align: center;
      margin: 20px 0;
    }

    .realtime-link a {
      display: inline-block;
      background-color: var(--primary-color);
      color: white;
      padding: 12px 24px;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    .realtime-link a:hover {
      background-color: var(--primary-dark);
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }

      .search-box {
        max-width: 100%;
      }

      .pagination {
        flex-direction: column;
        align-items: flex-start;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .data-table {
        display: block;
        overflow-x: auto;
      }
    }

    @media (max-width: 480px) {
      .pagination-controls {
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
      }
      
      .card-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        Mezo Matsnet Activity Statistics
        <div class="visit-counter">
          <span id="total-visits">0</span> total visits | <span id="today-visits">0</span> today
        </div>
      </div>
      <div class="credit">
        <a href="https://mallardlabs.xyz" target="_blank">by Mallard Labs</a>
      </div>
    </div>
  </header>

  <div class="container">
    <div id="loading" class="loader">
      <div class="spinner"></div>
    </div>

    <div id="error-container" class="error-message hidden">
      Error loading data. Please try again later.
    </div>

    <div id="main-content" class="main-content hidden">
      <!-- Statistics Section -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Dataset Statistics</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Total Addresses</div>
            <div class="stat-value" id="total-addresses">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Transactions</div>
            <div class="stat-value" id="total-transactions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Average Transactions</div>
            <div class="stat-value" id="avg-transactions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Max Transactions</div>
            <div class="stat-value" id="max-transactions">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Deployed Contracts</div>
            <div class="stat-value" id="total-contracts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Addresses with Contracts</div>
            <div class="stat-value" id="addresses-with-contracts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Claimed Matsnet Sats</div>
            <div class="stat-value" id="total-claimed-btc">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Addresses with Claimed Sats</div>
            <div class="stat-value" id="addresses-with-btc">0</div>
          </div>
        </div>
        <div class="realtime-link">
          <a href="https://test-mezo.drops.mallardlabs.xyz/" target="_blank">
            View the Network in real-time with Mallard Drops for Mezo Matsnet
          </a>
        </div>
      </div>

      <!-- Activity Table Section -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Address Activity</h2>
          <div class="search-box">
            <input type="text" id="address-search" class="search-input" placeholder="Search by address...">
          </div>
        </div>
        <div class="items-per-page">
          <label for="items-per-page">Items per page:</label>
          <select id="items-per-page">
            <option value="10" selected>10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        <table class="data-table">
          <thead>
            <tr>
              <th data-sort="address">Address</th>
              <th data-sort="tx_count" class="sorted-desc">Transactions</th>
              <th data-sort="deployed_contracts">Deployed Contracts</th>
              <th data-sort="deployed_contracts_tx_count">Contract Txs</th>
              <th data-sort="claimed_btc">Claimed Matsnet Sats</th>
            </tr>
          </thead>
          <tbody id="activity-table-body">
            <!-- Data will be populated here -->
          </tbody>
        </table>
        <div class="pagination">
          <div class="page-info">
            Showing <span id="current-range-start">0</span>-<span id="current-range-end">0</span> of <span id="total-items">0</span> addresses
          </div>
          <div class="pagination-controls">
            <button id="first-page" class="btn">First</button>
            <button id="prev-page" class="btn">Previous</button>
            <div class="jump-to-page">
              <span>Page</span>
              <input type="number" id="page-input" min="1" value="1">
              <span>of <span id="total-pages">1</span></span>
              <button id="go-to-page" class="btn">Go</button>
            </div>
            <button id="next-page" class="btn">Next</button>
            <button id="last-page" class="btn">Last</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // API URL - Use a relative URL to our Netlify function
    const API_URL = '/.netlify/functions/proxy-api';
    
    // State management
    let activityData = [];
    let currentPage = 1;
    let itemsPerPage = 10; // Default to 10 items per page
    let filteredData = [];
    let currentSortField = 'tx_count'; // Default sort by transactions
    let currentSortDirection = 'desc'; // Default sort direction is descending
    
    // DOM Elements
    const loadingElement = document.getElementById('loading');
    const errorContainer = document.getElementById('error-container');
    const mainContent = document.getElementById('main-content');
    const activityTableBody = document.getElementById('activity-table-body');
    const itemsPerPageSelect = document.getElementById('items-per-page');
    const prevPageButton = document.getElementById('prev-page');
    const nextPageButton = document.getElementById('next-page');
    const firstPageButton = document.getElementById('first-page');
    const lastPageButton = document.getElementById('last-page');
    const pageInput = document.getElementById('page-input');
    const goToPageButton = document.getElementById('go-to-page');
    const totalPagesElement = document.getElementById('total-pages');
    const currentRangeStart = document.getElementById('current-range-start');
    const currentRangeEnd = document.getElementById('current-range-end');
    const totalItemsElement = document.getElementById('total-items');
    const addressSearchInput = document.getElementById('address-search');
    const tableHeaders = document.querySelectorAll('.data-table th[data-sort]');
    const totalVisitsElement = document.getElementById('total-visits');
    const todayVisitsElement = document.getElementById('today-visits');
    
    // Stats elements
    const totalAddressesElement = document.getElementById('total-addresses');
    const totalTransactionsElement = document.getElementById('total-transactions');
    const avgTransactionsElement = document.getElementById('avg-transactions');
    const maxTransactionsElement = document.getElementById('max-transactions');
    const totalContractsElement = document.getElementById('total-contracts');
    const addressesWithContractsElement = document.getElementById('addresses-with-contracts');
    const totalClaimedBtcElement = document.getElementById('total-claimed-btc');
    const addressesWithBtcElement = document.getElementById('addresses-with-btc');
    
    // Format numbers with commas
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // Format claimed sats (divide by 10^10)
    function formatClaimedSats(value) {
      return formatNumber(Math.floor(Number(value) / 10000000000));
    }
    
    // Function to display visit counts from the server
    async function displayVisitCounts() {
      console.log("Fetching visit counts...");
      try {
        const response = await fetch('/.netlify/functions/counter');
        console.log("Response status:", response.status);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log("Received visit data:", data);
        
        document.getElementById('total-visits').textContent = formatNumber(data.total);
        document.getElementById('today-visits').textContent = formatNumber(data.today);
      } catch (error) {
        console.error("Error fetching visit counts:", error);
        // Fallback to localStorage if server fails
        displayLocalVisitCounts();
      }
    }
    
    // Function to track a new visit
    async function trackVisit() {
      console.log("Tracking visit...");
      try {
        const response = await fetch('/.netlify/functions/counter', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            page: window.location.pathname,
            timestamp: new Date().toISOString()
          })
        });
        
        console.log("Track visit response status:", response.status);
        const data = await response.json();
        console.log("Track visit response:", data);
        
        // Update the display with the returned counts
        if (data.success) {
          document.getElementById('total-visits').textContent = formatNumber(data.total);
          document.getElementById('today-visits').textContent = formatNumber(data.today);
        }
      } catch (error) {
        console.error("Error tracking visit:", error);
        // Fallback to localStorage if server fails
        trackLocalVisit();
      }
    }
    
    // Fetch data from API
    async function fetchData() {
      try {
        loadingElement.classList.remove('hidden');
        errorContainer.classList.add('hidden');
        mainContent.classList.add('hidden');
        
        const response = await fetch(API_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status} ${response.statusText}`);
        }
        
        // The data is now directly from our Netlify function, no need to parse contents
        const data = await response.json();
        
        if (data.success && Array.isArray(data.activity)) {
          activityData = data.activity;
          filteredData = [...activityData];
          sortData(currentSortField, currentSortDirection);
          renderActivityTable();
          calculateAndDisplayStats();
          mainContent.classList.remove('hidden');
        } else {
          throw new Error('Invalid data format');
        }
      } catch (error) {
        console.error('Detailed fetch error:', error);
        errorContainer.textContent = `Error loading data: ${error.message}`;
        errorContainer.classList.remove('hidden');
      } finally {
        loadingElement.classList.add('hidden');
      }
    }
    
    // Sort data
    function sortData(field, direction) {
      filteredData.sort((a, b) => {
        let valueA, valueB;
        
        // Special handling for claimed_btc to sort by actual value
        if (field === 'claimed_btc') {
          valueA = Math.floor(Number(a[field]) / 10000000000);
          valueB = Math.floor(Number(b[field]) / 10000000000);
        } else if (field === 'address') {
          valueA = a[field].toLowerCase();
          valueB = b[field].toLowerCase();
        } else {
          valueA = Number(a[field]);
          valueB = Number(b[field]);
        }
        
        if (direction === 'asc') {
          return valueA > valueB ? 1 : valueA < valueB ? -1 : 0;
        } else {
          return valueA < valueB ? 1 : valueA > valueB ? -1 : 0;
        }
      });
      
      // Update sort indicators in the table headers
      tableHeaders.forEach(header => {
        const headerField = header.getAttribute('data-sort');
        header.classList.remove('sorted-asc', 'sorted-desc');
        
        if (headerField === field) {
          header.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
        }
      });
      
      currentSortField = field;
      currentSortDirection = direction;
    }
    
    // Render activity table
    function renderActivityTable() {
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, filteredData.length);
      const displayData = filteredData.slice(startIndex, endIndex);
      
      activityTableBody.innerHTML = '';
      
      if (displayData.length === 0) {
        const emptyRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = 5;
        emptyCell.textContent = 'No data available';
        emptyCell.style.textAlign = 'center';
        emptyRow.appendChild(emptyCell);
        activityTableBody.appendChild(emptyRow);
      } else {
        displayData.forEach(item => {
          const row = document.createElement('tr');
          
          const addressCell = document.createElement('td');
          addressCell.textContent = item.address;
          addressCell.classList.add('address-cell');
          
          const txCountCell = document.createElement('td');
          txCountCell.textContent = item.tx_count;
          
          const deployedContractsCell = document.createElement('td');
          deployedContractsCell.textContent = item.deployed_contracts;
          
          const deployedContractsTxCell = document.createElement('td');
          deployedContractsTxCell.textContent = item.deployed_contracts_tx_count;
          
          const claimedBtcCell = document.createElement('td');
          claimedBtcCell.textContent = formatClaimedSats(item.claimed_btc);
          
          row.appendChild(addressCell);
          row.appendChild(txCountCell);
          row.appendChild(deployedContractsCell);
          row.appendChild(deployedContractsTxCell);
          row.appendChild(claimedBtcCell);
          
          activityTableBody.appendChild(row);
        });
      }
      
      // Update pagination info
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      totalPagesElement.textContent = totalPages;
      currentRangeStart.textContent = filteredData.length > 0 ? startIndex + 1 : 0;
      currentRangeEnd.textContent = endIndex;
      totalItemsElement.textContent = filteredData.length;
      
      // Update page input
      pageInput.value = currentPage;
      pageInput.max = totalPages;
      
      // Update button states
      prevPageButton.disabled = currentPage === 1;
      nextPageButton.disabled = currentPage === totalPages;
      firstPageButton.disabled = currentPage === 1;
      lastPageButton.disabled = currentPage === totalPages;
    }
    
    // Calculate and display statistics
    function calculateAndDisplayStats() {
      const totalAddresses = activityData.length;
      const totalTransactions = activityData.reduce((sum, item) => sum + item.tx_count, 0);
      const avgTransactions = totalAddresses > 0 ? (totalTransactions / totalAddresses).toFixed(2) : 0;
      const maxTransactions = activityData.reduce((max, item) => Math.max(max, item.tx_count), 0);
      
      const totalContracts = activityData.reduce((sum, item) => sum + item.deployed_contracts, 0);
      const addressesWithContracts = activityData.filter(item => item.deployed_contracts > 0).length;
      
      const totalClaimedBtc = activityData.reduce((sum, item) => sum + Math.floor(Number(item.claimed_btc) / 10000000000), 0);
      const addressesWithBtc = activityData.filter(item => Number(item.claimed_btc) > 0).length;
      
      totalAddressesElement.textContent = formatNumber(totalAddresses);
      totalTransactionsElement.textContent = formatNumber(totalTransactions);
      avgTransactionsElement.textContent = avgTransactions;
      maxTransactionsElement.textContent = formatNumber(maxTransactions);
      totalContractsElement.textContent = formatNumber(totalContracts);
      addressesWithContractsElement.textContent = formatNumber(addressesWithContracts);
      totalClaimedBtcElement.textContent = formatNumber(totalClaimedBtc);
      addressesWithBtcElement.textContent = formatNumber(addressesWithBtc);
    }
    
    // Search for addresses
    function searchAddress() {
      const searchTerm = addressSearchInput.value.trim().toLowerCase();
      
      if (searchTerm === '') {
        filteredData = [...activityData];
      } else {
        filteredData = activityData.filter(item => 
          item.address.toLowerCase().includes(searchTerm)
        );
      }
      
      sortData(currentSortField, currentSortDirection);
      currentPage = 1;
      renderActivityTable();
    }
    
    // Event listeners
    itemsPerPageSelect.addEventListener('change', function() {
      itemsPerPage = parseInt(this.value);
      currentPage = 1;
      renderActivityTable();
    });
    
    prevPageButton.addEventListener('click', function() {
      if (currentPage > 1) {
        currentPage--;
        renderActivityTable();
      }
    });
    
    nextPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderActivityTable();
      }
    });
    
    firstPageButton.addEventListener('click', function() {
      currentPage = 1;
      renderActivityTable();
    });
    
    lastPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      currentPage = totalPages;
      renderActivityTable();
    });
    
    goToPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const pageNum = parseInt(pageInput.value);
      
      if (pageNum >= 1 && pageNum <= totalPages) {
        currentPage = pageNum;
        renderActivityTable();
      } else {
        alert(`Please enter a page number between 1 and ${totalPages}`);
        pageInput.value = currentPage;
      }
    });
    
    addressSearchInput.addEventListener('input', searchAddress);
    
    // Add click event listeners to table headers for sorting
    tableHeaders.forEach(header => {
      header.addEventListener('click', function() {
        const field = this.getAttribute('data-sort');
        let direction = 'desc';
        
        // If already sorted by this field, toggle direction
        if (field === currentSortField) {
          direction = currentSortDirection === 'desc' ? 'asc' : 'desc';
        }
        
        sortData(field, direction);
        renderActivityTable();
      });
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Display visit counts first
      displayVisitCounts();
      
      // Track this visit
      trackVisit();
      
      // Fetch data
      fetchData();
    });
  </script>
</body>
</html>
