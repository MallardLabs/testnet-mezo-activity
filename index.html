          
          activityTableBody.appendChild(row);
        });
      }
      
      // Update pagination info
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      totalPagesElement.textContent = totalPages;
      currentRangeStart.textContent = filteredData.length > 0 ? startIndex + 1 : 0;
      currentRangeEnd.textContent = endIndex;
      totalItemsElement.textContent = filteredData.length;
      
      // Update page input
      pageInput.value = currentPage;
      pageInput.max = totalPages;
      
      // Update button states
      prevPageButton.disabled = currentPage === 1;
      nextPageButton.disabled = currentPage === totalPages;
      firstPageButton.disabled = currentPage === 1;
      lastPageButton.disabled = currentPage === totalPages;
    }
    
    // Calculate and display statistics
    function calculateAndDisplayStats() {
      const totalAddresses = activityData.length;
      const totalTransactions = activityData.reduce((sum, item) => sum + item.tx_count, 0);
      const avgTransactions = totalAddresses > 0 ? (totalTransactions / totalAddresses).toFixed(2) : 0;
      const maxTransactions = activityData.reduce((max, item) => Math.max(max, item.tx_count), 0);
      
      const totalContracts = activityData.reduce((sum, item) => sum + item.deployed_contracts, 0);
      const addressesWithContracts = activityData.filter(item => item.deployed_contracts > 0).length;
      
      // Update how total claimed BTC is calculated
      const totalClaimedBtc = activityData.reduce((sum, item) => sum + Number(item.claimed_btc), 0) / 10000000000;
      const addressesWithBtc = activityData.filter(item => Number(item.claimed_btc) > 0).length;
      
      totalAddressesElement.textContent = formatNumber(totalAddresses);
      totalTransactionsElement.textContent = formatNumber(totalTransactions);
      avgTransactionsElement.textContent = avgTransactions;
      maxTransactionsElement.textContent = formatNumber(maxTransactions);
      totalContractsElement.textContent = formatNumber(totalContracts);
      addressesWithContractsElement.textContent = formatNumber(addressesWithContracts);
      totalClaimedBtcElement.textContent = formatNumber(Math.floor(totalClaimedBtc));
      addressesWithBtcElement.textContent = formatNumber(addressesWithBtc);
    }
    
    // Search for addresses
    function searchAddress() {
      const searchTerm = addressSearchInput.value.trim().toLowerCase();
      
      if (searchTerm === '') {
        // Clear search
        searchResultsBody.innerHTML = '';
        const emptyRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = 5;
        emptyCell.textContent = 'Enter an address to search';
        emptyCell.style.textAlign = 'center';
        emptyRow.appendChild(emptyCell);
        searchResultsBody.appendChild(emptyRow);
        return;
      }
      
      const results = activityData.filter(item => 
        item.address.toLowerCase().includes(searchTerm)
      );
      
      searchResultsBody.innerHTML = '';
      
      if (results.length === 0) {
        const emptyRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = 5;
        emptyCell.textContent = 'No matching addresses found';
        emptyCell.style.textAlign = 'center';
        emptyRow.appendChild(emptyCell);
        searchResultsBody.appendChild(emptyRow);
      } else {
        results.forEach(item => {
          const row = document.createElement('tr');
          
          const addressCell = document.createElement('td');
          addressCell.textContent = item.address;
          addressCell.classList.add('address-cell');
          
          const txCountCell = document.createElement('td');
          txCountCell.textContent = item.tx_count;
          
          const deployedContractsCell = document.createElement('td');
          deployedContractsCell.textContent = item.deployed_contracts;
          
          const deployedContractsTxCell = document.createElement('td');
          deployedContractsTxCell.textContent = item.deployed_contracts_tx_count;
          
          const claimedBtcCell = document.createElement('td');
          claimedBtcCell.textContent = formatSats(item.claimed_btc);
          
          row.appendChild(addressCell);
          row.appendChild(txCountCell);
          row.appendChild(deployedContractsCell);
          row.appendChild(deployedContractsTxCell);
          row.appendChild(claimedBtcCell);
          
          searchResultsBody.appendChild(row);
        });
      }
    }
    
    // Switch tabs
    function switchTab(tabId) {
      // Hide all tabs
      activityTab.classList.remove('active');
      statsTab.classList.remove('active');
      searchTab.classList.remove('active');
      
      // Remove active class from all nav items
      navActivity.classList.remove('active');
      navStats.classList.remove('active');
      navSearch.classList.remove('active');
      
      // Show selected tab
      document.getElementById(tabId).classList.add('active');
      
      // Add active class to selected nav item
      if (tabId === 'activity-tab') {
        navActivity.classList.add('active');
      } else if (tabId === 'stats-tab') {
        navStats.classList.add('active');
      } else if (tabId === 'search-tab') {
        navSearch.classList.add('active');
      }
    }
    
    // Event listeners
    itemsPerPageSelect.addEventListener('change', function() {
      itemsPerPage = parseInt(this.value);
      currentPage = 1;
      renderActivityTable();
    });
    
    prevPageButton.addEventListener('click', function() {
      if (currentPage > 1) {
        currentPage--;
        renderActivityTable();
      }
    });
    
    nextPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderActivityTable();
      }
    });
    
    firstPageButton.addEventListener('click', function() {
      currentPage = 1;
      renderActivityTable();
    });
    
    lastPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      currentPage = totalPages;
      renderActivityTable();
    });
    
    goToPageButton.addEventListener('click', function() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const pageNum = parseInt(pageInput.value);
      
      if (pageNum >= 1 && pageNum <= totalPages) {
        currentPage = pageNum;
        renderActivityTable();
      } else {
        alert(`Please enter a page number between 1 and ${totalPages}`);
        pageInput.value = currentPage;
      }
    });
    
    searchButton.addEventListener('click', searchAddress);
    
    addressSearchInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        searchAddress();
      }
    });
    
    navActivity.addEventListener('click', function(e) {
      e.preventDefault();
      switchTab('activity-tab');
    });
    
    navStats.addEventListener('click', function(e) {
      e.preventDefault();
      switchTab('stats-tab');
    });
    
    navSearch.addEventListener('click', function(e) {
      e.preventDefault();
      switchTab('search-tab');
    });
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      fetchData();
    });
  </script>
</body>
</html>
